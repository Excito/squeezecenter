#!/usr/bin/make -f
# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

%:
	dh  $@

override_dh_install:
	install -m0755 slimserver.pl debian/squeezecenter/usr/sbin/squeezecenter-server
	install -m0755 scanner.pl debian/squeezecenter/usr/sbin/squeezecenter-scanner
	install -m0755 debian/squeezecenter_safe debian/squeezecenter/usr/sbin/squeezecenter_safe
	install -d debian/squeezecenter/usr/share/dbconfig-common/data/squeezecenter/install
	cat $(foreach idx,$(shell seq 1 100),$(wildcard SQL/mysql/schema_$(idx)_up.sql)) > debian/squeezecenter/usr/share/dbconfig-common/data/squeezecenter/install/mysql
	install -d debian/squeezecenter/usr/share/dbconfig-common/data/squeezecenter/upgrade/mysql
	cat SQL/mysql/schema_7_up.sql  SQL/mysql/schema_8_up.sql > debian/squeezecenter/usr/share/dbconfig-common/data/squeezecenter/upgrade/mysql/7.2.99
	cat SQL/mysql/schema_9_up.sql  SQL/mysql/schema_10_up.sql > debian/squeezecenter/usr/share/dbconfig-common/data/squeezecenter/upgrade/mysql/7.4.0
	cat SQL/mysql/schema_11_up.sql  SQL/mysql/schema_12_up.sql > debian/squeezecenter/usr/share/dbconfig-common/data/squeezecenter/upgrade/mysql/7.6.0
	# fix changelogs
	mkdir debian/tmp
	for i in Changelog?.html; do html2text -style pretty $$i; done > debian/tmp/changelog
	dh_install
	# Remove errmsg.sys files from the MySQL dir, since they may not match
	# up with the installed version's
	rm -f debian/squeezecenter/usr/share/squeezecenter/MySQL/errmsg.*
	# Fix some executable flags which shouldn't be there
	find debian/squeezecenter/ -regex '.*\.\(png\|gif\|html\)' | xargs chmod -x
	# remove loose license files
	rm -f debian/squeezecenter/usr/share/squeezecenter/HTML/EN/html/ext/license.txt
	rm -f debian/squeezecenter/usr/share/squeezecenter/HTML/EN/html/ext/resources/license.txt
	rm -f debian/squeezecenter/usr/share/squeezecenter/MySQL/COPYING

override_dh_installinit:
	dh_installinit --noscripts
