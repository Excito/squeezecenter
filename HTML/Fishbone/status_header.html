[%- IF ajaxRequest -%]
	<pre>
	[% PROCESS ajaxRequest.txt page = 'status' %][% PROCESS FBajaxRequest.txt page='status' %][% IF NOT light %][% PROCESS ajaxRequest.txt page = 'playlist' %][% END %]y
	</pre>
[%- ELSE -%]
[%- FILTER null %]

[% BLOCK spacer -%]
<img src="[% webroot %]html/images/spacer.gif" alt="" title="" width="0">
[%- END %]

[% BLOCK volumectl %]
<a class="volfragment" href="javascript:processVolume('p0=mixer&amp;p1=volume&amp;p2=[% vol %]');">[% PROCESS spacer %]</a>
[% END %]

[%- BLOCK progressOverlay -%]
<div class="progressBarOverlay">
[%- FOREACH jump = [1..20] -%]
<div class="segment" onClick="processBarClick([% jump %]);"><img src="[% webroot %]html/images/spacer.gif" alt="" title="" width="0" height="4"></div>
[%- END -%]</div>
[%- END -%]

[%- BLOCK volumecontrol %]
	[% vols = {
			'2' => '0', '4' => '6', '6' => '12', '8' => '18',
			'10' => '24', '12' => '30', '14' => '36', '16' => '42', '18' => '48',
			'20' => '54', '22' => '60', '24' => '66', '26' => '72', '28' => '78',
			'30' => '84', '32' => '90', '34' => '95', '36' => '100',
		}
	%]
	[%- FOREACH level = vols.nsort.reverse %]
	<div id="volumeBar[% level %]" class="volumeBar">
		<div style="height: [% 37-level %]px;">[% PROCESS volumectl vol = vols.$level %]</div>
		<div id="volDiv[% level %]" style="height: [% level %]px;background-color: [% IF volume < vols.$level %]#808080[% ELSE %]#00C000[% END %];">[% PROCESS volumectl vol = vols.$level %]</div>
	</div>
	<div class="volumeSpacer">
		[% PROCESS volumectl vol = vols.$level %]
	</div>
	[%- END -%]
[% END -%]

[% BLOCK statectrl %]
	<a id="[% item %][% IF item == 'playlist' %][% command %][% END %][% loop.index %]" class="[% IF not condition %]dark[% END %]button" href="javascript:processState('p0=[% item || 'playlist' %]&amp;p1=[% command %]&amp;p2=[% arg %]');[% IF command == 'shuffle' %]getPlaylistData();[% END %]"><b>[% cmdstring | string | upper%]</b></a>
[% END %]

[% BLOCK playctl %]
<td>
	<a href="javascript:processPlayControls('[% command %]')">
	<img id="playCtl[% img %]" class="gray" alt="[% img | ucfirst %]" title="[% img | ucfirst %]" src="[% webroot %]html/images/[% img %][% IF condition %]_s[% END %].gif" border="1" width="[% width || 30 %]" height="[% height || 19 %]"><img id="playCtl[% img %]_tan" class="tan" alt="[% img %]" title="[% img %]" src="[% webroot %]html/images/[% img %][% IF condition %]_s[% END %]_tan.gif" width="[% width %]" height="[% height %]"></a>
</td>
[% END %]

[% BLOCK remove %]
	<a class="label" href="[% statusroot %]?command=playlist&amp;subcommand=deletetracks&amp;[% param %]=[% value | uri | replace("'", "%27") %]&amp;player=[% playerURI %]" title='[% "REMOVE_FROM_PLAYLIST" | string %]'>[x]</a>
[% END %]

[% END -%]
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
	[% pagetitle = player_name %]
	[% PROCESS customheader.html %]
	<script TYPE="text/javascript">[% PROCESS html/vars.js %]</script>
	<script TYPE="text/javascript" src="[% webroot %]html/common.js?r=[% revision %]"></script>
	<script type="text/javascript" src="[% webroot %]html/prototype.js?r=[% revision %]" ></script>
	<script type="text/javascript" src="[% webroot %]html/scriptaculous/scriptaculous.js?r=[% revision %]"></script>
	<script TYPE="text/javascript" src="[% webroot %]html/songprogress.js?r=[% revision %]"></script>
	<script TYPE="text/javascript">[% PROCESS html/ajax.js %]</script>
	<script TYPE="text/javascript" src="[% webroot %]html/global.js?r=[% revision %]"></script>
	[% IF playercount == '0' %]<script TYPE="text/javascript">
		<!--Hide
		[% IF undock %]self.close();[% ELSE %]
		location="status.html";[% END %]
		-->
	</script>[% END %]
</head>

<body bgcolor="#FFFFFF" style="margin: 0;padding:0;" onresize="resizePlaylist();" [% IF NOT undock %]onload="doAjaxRefresh('onload');"[% END %]>
	<div ID="header">
		<div id="mastHead">
			<div id="playerlogo">
				<img id="logoimage" class="gray" src="[% webroot %]html/images/[% playermodel %]_logo.small.gif" alt="[% playermodel %]" title="[% playermodel %]" width="98" height="17">
				<img id="logoimage_tan" class="tan" src="[% webroot %]html/images/[% playermodel %]_logo.small_tan.gif" alt="[% playermodel %]" title="[% playermodel %]" width="98" height="17">
			</div>
			<div id="waiting">
				[% "CONNECTING_FOR" | string | upper %].
			</div>
			<div id="commandInProgress" style="display: none;">
				[% "LOADING" | string | upper %].
			</div>
			<div id="playerlinks">
			[% IF undock %]<span id="inc"></span>  [% END %]
				
				<span id="unsync">[% IF sync %]<a href="[% statusroot %]?p0=sync&p1=-&player=[% playerURI %]">[% "UNSYNC" | string %]</a>
				 / [% END %]</span>
				
				<span id="sleeplink"><A href="javascript:processSleepLink('p0=button&amp;p1=sleep');"><span id='sleeptime'>[% IF sleeptime %][% sleep %][% ELSE %][% "SLEEP" | string %][% END %]</span></a>
				 / </span>
				
				[% IF not nosetup  %]<a href="settings/player/basic.html?player=[% playerURI %]&amp;playerid=[% playerURI %]" target="browser">[% "SETTINGS" | string %]</a>
				[%- END -%]
				[%- IF not undock -%] /
				<a href="javascript:openRemote()">Undock</a>
				<img id="statusImg_up" alt="Hide" title="Hide" src="html/images/b_up.gif" onClick="toggleStatus(['TopMenu1','TopMenu2','TopMenu3']);resizePlaylist();">
				<img id="statusImg_down" alt="Show" title="Show" style="display:none;" src="html/images/b_down.gif" onClick="toggleStatus(['TopMenu1','TopMenu2','TopMenu3']);resizePlaylist();">
				[%- END %]
			</div>
		</div>

[%- IF NOT undock -%]
		<div id="menuHeader">
			<form id="playerForm" action="javascript:return(false);">
				[% IF player_chooser_list -%]
					<select name="player" onchange="changePlayer(this);" class="stdedit">[% player_chooser_list %]</select>
				[%- ELSE -%]
					[% IF player_name -%]<span class="songtitle">[% player_name %]</span>[%- END -%]
					[%- IF sync %][% "SYNCHRONIZED_WITH" | string %] [% sync %][% END -%]
				[%- END %]
			</form>
		</div>
[% END %]

		<script TYPE="text/javascript">
		<!--
		if (document.all||document.getElementById)
			insertProgressBar([% IF modeplay %]1[% ELSE %]0[% END %],[% IF durationseconds %][% durationseconds %][% ELSE %][% refresh %][% END %],[% IF songtime %][% songtime %][% ELSE %]0[% END %]);
		else
			window.onload=insertProgressBar([% IF modeplay %]1[% ELSE %]0[% END %],[% IF durationseconds %][% durationseconds %][% ELSE %][% refresh %][% END %],[% IF songtime %][% songtime %][% ELSE %]0[% END %]);
		-->
		</script>
[%- PROCESS progressOverlay -%]
		<div id="TopMenu1">
			<div id="coverart">
				<span id='coverhref'>[% IF coverThumb -%]
					<a id="coverarthref" [% albumHRef %] target="browser">[%- PROCESS statusImg width="100" -%]
				[%- ELSIF itemobj.isRemoteURL && plugin_meta.cover -%]
					<a id="coverarthref" [% songinfoHRef %] target="browser"><img src="[% plugin_meta.cover %]" width="100" id="coverartpath">
				[%- ELSIF itemobj.isRemoteURL && plugin_meta.icon -%]
					<a id="coverarthref" [% songinfoHRef %] target="browser"><img src="[% plugin_meta.icon %].png" width="100" id="coverartpath">
				[%- ELSE -%]
					<a id="coverarthref" [% albumHRef %] target="browser"><img src="[% webroot %]html/images/cover_100x100_p.png" id="coverartpath" alt="" title="" width = '100' height="100">
				[%- END %]</a></span>
			</div>
			<div id="notplaying" [% IF currentsong %]style="display:none;"[% END %]>
				<div class="label">[% "PLAYLIST_EMPTY" | string %][% "COLON" | string %]</div>
			</div>
			<div id="nowplaying" [% IF NOT currentsong %]style="display:none;"[% END %]>
				<div class="label">[% IF modeplay  %][% status = "PLAYING"    %][% END %][% IF modepause %][% status = "PAUSED_ON"  %][% END %][% IF modestop  %][% status = "STOPPED_ON" %][% END %]
				<span id="playtextmode">[% IF currentsong %][% status | string %][% END %]</span>
				<span id="thissongnum">[% IF currentsong %][% currentsong %][% END %]</span><span id="outof">&nbsp;[% "OUT_OF" | string %]&nbsp;</span><span id="songcount">[% IF songcount %][% songcount %][% END %]</span>&nbsp;
				<span id="zaphref"><a class="label" href="[% statusroot %]?p0=playlist&amp;p1=zap&amp;p2=[% thissongnum %]&amp;player=[% playerURI %]" title='Move to Zapped playlist'>[zap]</a></span>[% "COLON" | string %]</div>
				<div id="songtitlehref" class="currentSongData"><a class="songtitle" [% songinfoHRef %] target="browser"><span id="songtitle">[% IF itemobj.title %][% itemobj.title %][% END %]</span></a>
				&nbsp;<span id="duration">[% IF itemobj.duration %]([% itemobj.duration | html %])[% END %]</span>&nbsp;<span id="bitrate">[% IF bitrate %]([% bitrate %])[% END %]</span></div>
				
				<div id="artistinfo" class="label">[% "ARTIST" | string %]&nbsp;<span id="removeartisthref">[% PROCESS remove param="contributor.id" value = "$itemobj.artist.id" %]</span></div>
				<span id="artisthtml">[% PROCESS artistsAsHTML.html noby=1 %]</span>
				
				<div id="albuminfo" class="label">[% "ALBUM" | string %]&nbsp;<span id="removealbumhref">[% PROCESS remove param="album.id" value = "$itemobj.album.id" %]</span></div>
				<span id="albumhref"><a [% albumHRef %] target="browser"><span id="album">[% IF itemobj.album.title %][% itemobj.album.title | html %][% END %]</span></a>&nbsp;</span>
				<span id="yearinfo">(<span id="yearhref"><a [% yearHRef %] target="browser"><span id="year">[% IF itemobj.year %][% itemobj.year %][% END %]</span></a></span>)</span>
			</div>
		</div>
	
		<div id="TopMenu2">
			<div id="playControls">
				<table><tr valign="bottom">
						[% PROCESS playctl command='p0=play' img='play' width='42' height='43' condition=modeplay && rate == 'norm' -%]
						[% PROCESS playctl command='p0=stop' img='stop' width='23' height='32' condition=modestop -%]
					<td><table>
						<tr>
							[% PROCESS playctl command='p0=button&amp;p1=rew.hold' width='30' height='19' img='rew' condition=rate == 'rew' -%]
							[% PROCESS playctl command='p0=button&amp;p1=fwd.hold' img='ffwd' condition=rate == 'ffwd' -%]
							<td></td><td></td>
						</tr><tr>
							[% plusone = '%2B1' | uri -%][%- minusone = '%2D1' | uri -%]
							[%- PROCESS playctl command="p0=playlist&amp;p1=jump&amp;p2=$minusone" width='30' height='19' img='back' condition='0' -%]
							[%- PROCESS playctl command="p0=playlist&amp;p1=jump&amp;p2=$plusone" img='forward' condition='0' -%]
							[%- PROCESS playctl command='p0=pause' img='pause' condition=modepause -%]
							[%- PROCESS playctl command='p0=button&amp;p1=muting' img='mute' condition=mute -%]
						</tr>
					</table></td>
			</tr></table></div>

			<div id="volumeControl"><div class="volwidth">
				[% PROCESS volumecontrol %]
				<div id="volumeBarText">
					<div class="attributeBold">[% "VOLUME" | string | upper%][% "COLON" | string %]</div>
				</div>
			</div></div>

		</div>
		
		<div id="TopMenu3">
			<div id="repeatButtons">
					<div class="attributeBold">[% "REPEAT" | string | upper%][% "COLON" | string %]</div>
					[% FOREACH type = ['off','one','all'] %]
						[% PROCESS statectrl item = 'playlist' condition=repeat == loop.index command='repeat' arg=loop.index cmdstring=type %]
					[% END %]
			</div>
			
			<div id="powerButtons">
					<div class="attributeBold">[% "POWER" | string | upper%][% "COLON" | string %]</div>
					[% FOREACH type = ['on','off'] %]
						[% PROCESS statectrl condition=mode == type item='power' command=1-loop.index arg='' cmdstring=type %]
					[% END %]
			</div>
			
			<div id="shuffleButtons">
					<div class="attributeBold">[% "SHUFFLE" | string | upper%][% "COLON" | string %]</div>
					[% FOREACH type = ['off','song','album'] %]
						[% PROCESS statectrl condition=shuffle == loop.index item = 'playlist' command='shuffle' arg=loop.index cmdstring=type %]
					[% END %]
			</div>
		</div>

[% IF NOT undock %]	
		<div id="playlistStatus">
			<div id="currentPlaylist">
				[% "CURRENT_PLAYLIST" | string %][% "COLON" | string %]
				<span id="playlistName">[% IF current_playlist %][% current_playlist_name %][% END %]</span>
				<span id="playlistSize">[% IF myClientState %]([% myClientState.playlist.size %] [% "SONGS" | string %])[% END %]</span>
				<span id="playlistModified" style="display:none">([% "MODIFIED" | string %])</span>
			</div>
			
			<div id="playlistLinks">
				[% img = '' %]<span id="saveplaylist" style="display:none;">[% PROCESS savePlaylistLink %] / </span>
				<span id="playlistdownload" style="display:none;">[% PROCESS downloadPlaylistLink playlist_items = 1 %] /</span>
				<span id="playlistclear" style="display:none;"><a href="javascript:processPlayControls('p0=playlist&amp;p1=clear');">[% "CLEAR" | string %]</a></span>
			</div>

			<div id="deleteitem" style="display:none;" onMouseOut="$('deleteitem').style.backgroundColor = 'maroon';">Drag here to delete</div>
		</div>

		<div id = "playlistframe">[% playlist %]</div>
		<script type="text/javascript">
			
			resizePlaylist();
			
			Droppables.add(
				'playlistStatus', 
				{
					onHover: function () {
						$('deleteitem').style.backgroundColor = 'limegreen';
					},
					onDrop: function (element) {
						hideElements([element.id]),
						deletePlaylistItem(element, [% IF start %][% start %][% ELSE %]0[% END %]);
						Sortable.destroy('playlist_draglist');
					}
				}
			);
		</script>
[% END %]
[% PROCESS pagefooter.html %]
[% END %]